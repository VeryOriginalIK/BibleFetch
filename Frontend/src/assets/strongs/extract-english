const fs = require('fs');

// Változtasd meg a fájlnevet szükség szerint (hebrew/greek)
const INPUT_FILE = 'strongs-reekg-dictionary.js';
const OUTPUT_FILE = 'strongs_master_greek_list.csv';

function generateCSV() {
    try {
        if (!fs.existsSync(INPUT_FILE)) throw new Error(`Nincs meg a fájl: ${INPUT_FILE}`);

        const rawContent = fs.readFileSync(INPUT_FILE, 'utf-8');
        const firstBrace = rawContent.indexOf('{');
        const lastBrace = rawContent.lastIndexOf('}');
        const dictionary = JSON.parse(rawContent.substring(firstBrace, lastBrace + 1));

        const sortedKeys = Object.keys(dictionary).sort((a, b) => {
            return parseInt(a.substring(1)) - parseInt(b.substring(1));
        });

        // CSV Fejléc
        let csvContent = "StrongID;OriginalWord;Transliteration;EnglishDefinition;HungarianDefinition\n";

        sortedKeys.forEach(key => {
            const entry = dictionary[key];
            
            // Adatok tisztítása (hogy a CSV ne törjön el)
            const lemma = (entry.lemma || "").replace(/;/g, ",");
            const translit = (entry.translit || "").replace(/;/g, ",");
            // Az angol definícióban lévő idézőjeleket és pontosvesszőket kezelni kell
            let def = (entry.strongs_def || "").replace(/\n/g, " ").replace(/;/g, ",").replace(/"/g, "'");

            // A sor összeállítása (az utolsó mező üres marad a magyarnak)
            csvContent += `${key};${lemma};${translit};"${def}";\n`;
        });

        fs.writeFileSync(OUTPUT_FILE, csvContent, 'utf-8');
        console.log(`Kész! A '${OUTPUT_FILE}' létrejött. Töltsd fel ezt a fájlt a chatbe!`);

    } catch (e) {
        console.error(e.message);
    }
}

generateCSV();